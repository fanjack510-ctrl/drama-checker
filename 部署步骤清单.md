# ä» 0 åˆ°ä¸Šçº¿å¯è®¿é—® - å®Œæ•´éƒ¨ç½²æ­¥éª¤æ¸…å•

## ğŸ“‹ å‰ç½®æ£€æŸ¥

### æ£€æŸ¥ 1ï¼šç¡®è®¤é¡¹ç›®ç»“æ„
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ schema.py
â”‚   â”œâ”€â”€ scorer_rules.py
â”‚   â””â”€â”€ config.py
â””â”€â”€ index.html
```

**é¢„æœŸç»“æœ**ï¼šç¡®è®¤ä»¥ä¸Šæ–‡ä»¶éƒ½å­˜åœ¨

---

## A. åç«¯ï¼ˆRailwayï¼‰éƒ¨ç½²

### A1. æœ¬åœ°è‡ªæ£€ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

#### æ­¥éª¤ 1ï¼šè¿›å…¥ backend ç›®å½•
```bash
cd backend
```

#### æ­¥éª¤ 2ï¼šæ£€æŸ¥ Python ç‰ˆæœ¬
```bash
python --version
```
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤º `Python 3.8.x` æˆ–æ›´é«˜ç‰ˆæœ¬

#### æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰
```bash
pip install -r requirements.txt
```
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤º `Successfully installed fastapi-0.104.1 uvicorn-0.24.0 ...`

#### æ­¥éª¤ 4ï¼šå¯åŠ¨æœ¬åœ°æœåŠ¡
```bash
uvicorn main:app --host 0.0.0.0 --port 8000
```
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤º
```
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000
```

#### æ­¥éª¤ 5ï¼šæµ‹è¯•å¥åº·æ£€æŸ¥ï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰

**Windows PowerShellï¼š**
```powershell
curl.exe http://localhost:8000/health
```

**Windows CMDï¼š**
```cmd
curl.exe http://localhost:8000/health
```

**Linux/Macï¼š**
```bash
curl http://localhost:8000/health
```

**æˆ–è€…ä½¿ç”¨æµè§ˆå™¨ç›´æ¥è®¿é—®ï¼š**
```
http://localhost:8000/health
```

**é¢„æœŸç»“æœ**ï¼šè¿”å› `{"ok":true}`

**æç¤º**ï¼šå¦‚æœ curl å‘½ä»¤æœ‰é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—® `http://localhost:8000/health`ï¼Œæˆ–è€…è¿è¡Œ `backend/test_api.bat`ï¼ˆWindowsï¼‰æˆ– `backend/test_api.ps1`ï¼ˆPowerShellï¼‰

#### æ­¥éª¤ 6ï¼šæµ‹è¯• APIï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰

**Windows PowerShellï¼ˆæ¨èï¼‰ï¼š**
```powershell
curl.exe -X POST http://localhost:8000/api/analyze -H "Content-Type: application/json" -d '{\"text\":\"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ç„¶åæˆ‘å›å®¶äº†ã€‚\",\"mode\":\"drama_emotion\"}'
```

**Windows CMDï¼š**
```cmd
curl.exe -X POST http://localhost:8000/api/analyze -H "Content-Type: application/json" -d "{\"text\":\"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ç„¶åæˆ‘å›å®¶äº†ã€‚\",\"mode\":\"drama_emotion\"}"
```

**æˆ–è€…ä½¿ç”¨ PowerShell çš„ Invoke-WebRequestï¼ˆæ›´ç®€å•ï¼‰ï¼š**
```powershell
$body = @{
    text = "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ç„¶åæˆ‘å›å®¶äº†ã€‚"
    mode = "drama_emotion"
} | ConvertTo-Json

Invoke-WebRequest -Uri http://localhost:8000/api/analyze -Method POST -Body $body -ContentType "application/json" | Select-Object -ExpandProperty Content
```

**Linux/Macï¼š**
```bash
curl -X POST http://localhost:8000/api/analyze \
  -H "Content-Type: application/json" \
  -d '{"text":"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ç„¶åæˆ‘å›å®¶äº†ã€‚","mode":"drama_emotion"}'
```

**é¢„æœŸç»“æœ**ï¼šè¿”å› JSONï¼ŒåŒ…å« `score`ã€`risk_level`ã€`summary` ç­‰å­—æ®µï¼Œä¾‹å¦‚ï¼š
```json
{
  "score": 65,
  "risk_level": "warn",
  "summary": ["å‰5ç§’ç¼ºä¹æ˜ç¡®å†²çªæˆ–æ‚¬å¿µ", "..."],
  ...
}
```

#### æ­¥éª¤ 7ï¼šåœæ­¢æœ¬åœ°æœåŠ¡
åœ¨è¿è¡Œ uvicorn çš„ç»ˆç«¯æŒ‰ `Ctrl+C`

---

### A2. å‡†å¤‡ GitHub ä»“åº“

#### æ­¥éª¤ 1ï¼šç¡®è®¤ä»£ç å·²æäº¤
```bash
git status
```
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤º `nothing to commit, working tree clean`

#### æ­¥éª¤ 2ï¼šæ¨é€åˆ° GitHubï¼ˆå¦‚æœè¿˜æ²¡æ¨é€ï¼‰
```bash
git add .
git commit -m "å‡†å¤‡éƒ¨ç½²"
git push origin main
```
**é¢„æœŸç»“æœ**ï¼šä»£ç æˆåŠŸæ¨é€åˆ° GitHub

---

### A3. Railway éƒ¨ç½²ï¼ˆè¯¦ç»†æ­¥éª¤ï¼‰

#### æ­¥éª¤ 1ï¼šç™»å½• Railway
1. è®¿é—® https://railway.app
2. ç‚¹å‡»å³ä¸Šè§’ "Login"
3. é€‰æ‹© "Login with GitHub"
4. æˆæƒ Railway è®¿é—®ä½ çš„ GitHub

**é¢„æœŸç»“æœ**ï¼šè¿›å…¥ Railway Dashboard

#### æ­¥éª¤ 2ï¼šæ–°å»ºé¡¹ç›®
1. ç‚¹å‡» "New Project"
2. é€‰æ‹© "Deploy from GitHub repo"
3. å¦‚æœé¦–æ¬¡ä½¿ç”¨ï¼Œç‚¹å‡» "Configure GitHub App"
4. é€‰æ‹©è¦æˆæƒçš„ä»“åº“ï¼ˆæˆ–é€‰æ‹© "All repositories"ï¼‰
5. ç‚¹å‡» "Install"
6. å›åˆ° Railwayï¼Œåˆ·æ–°é¡µé¢
7. é€‰æ‹©ä½ çš„ GitHub ä»“åº“

**é¢„æœŸç»“æœ**ï¼šRailway å¼€å§‹æ£€æµ‹é¡¹ç›®

#### æ­¥éª¤ 3ï¼šé…ç½® Root Directory
1. ç‚¹å‡»é¡¹ç›®å¡ç‰‡è¿›å…¥é¡¹ç›®è¯¦æƒ…
2. ç‚¹å‡»é¡¶éƒ¨ "Settings" æ ‡ç­¾
3. æ‰¾åˆ° "Root Directory" è®¾ç½®
4. ç‚¹å‡» "Edit"
5. è¾“å…¥ï¼š`backend`
6. ç‚¹å‡» "Save"

**é¢„æœŸç»“æœ**ï¼šRoot Directory æ˜¾ç¤ºä¸º `backend`

#### æ­¥éª¤ 4ï¼šé…ç½® Start Command
1. åœ¨ Settings é¡µé¢ï¼Œæ‰¾åˆ° "Deploy" éƒ¨åˆ†
2. æ‰¾åˆ° "Start Command" è®¾ç½®
3. ç‚¹å‡» "Edit"
4. è¾“å…¥ï¼š
```bash
uvicorn main:app --host 0.0.0.0 --port $PORT
```
5. ç‚¹å‡» "Save"

**é¢„æœŸç»“æœ**ï¼šStart Command æ˜¾ç¤ºä¸º `uvicorn main:app --host 0.0.0.0 --port $PORT`

#### æ­¥éª¤ 5ï¼šé…ç½®ç¯å¢ƒå˜é‡
1. åœ¨ Settings é¡µé¢ï¼Œæ‰¾åˆ° "Variables" éƒ¨åˆ†
2. ç‚¹å‡» "New Variable"
3. æ·»åŠ ç¬¬ä¸€ä¸ªå˜é‡ï¼š
   - **Name**: `LLM_ENABLED`
   - **Value**: `true`
   - ç‚¹å‡» "Add"
4. æ·»åŠ ç¬¬äºŒä¸ªå˜é‡ï¼š
   - **Name**: `QWEN_API_KEY`
   - **Value**: `ä½ çš„é€šä¹‰åƒé—®APIå¯†é’¥`ï¼ˆä»é˜¿é‡Œäº‘æ§åˆ¶å°è·å–ï¼‰
   - ç‚¹å‡» "Add"

**é¢„æœŸç»“æœ**ï¼šVariables åˆ—è¡¨æ˜¾ç¤ºä¸¤ä¸ªå˜é‡

#### æ­¥éª¤ 6ï¼šç­‰å¾…éƒ¨ç½²å®Œæˆ
1. å›åˆ°é¡¹ç›®ä¸»é¡µé¢ï¼ˆç‚¹å‡»é¡¹ç›®åç§°ï¼‰
2. æŸ¥çœ‹ "Deployments" æ ‡ç­¾
3. ç­‰å¾…éƒ¨ç½²çŠ¶æ€å˜ä¸º "Active"ï¼ˆç»¿è‰²ï¼‰

**é¢„æœŸç»“æœ**ï¼š
- éƒ¨ç½²æ—¥å¿—æ˜¾ç¤º "Application startup complete"
- çŠ¶æ€æ˜¾ç¤ºç»¿è‰² "Active"
- å³ä¾§æ˜¾ç¤ºå…¬ç½‘ URLï¼Œä¾‹å¦‚ï¼š`https://xxx-production.up.railway.app`

#### æ­¥éª¤ 7ï¼šå¤åˆ¶å…¬ç½‘åŸŸå
1. åœ¨é¡¹ç›®ä¸»é¡µé¢ï¼Œæ‰¾åˆ° "Domains" éƒ¨åˆ†
2. ç‚¹å‡» "Generate Domain"ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
3. å¤åˆ¶ç”Ÿæˆçš„åŸŸåï¼Œä¾‹å¦‚ï¼š`https://xxx-production.up.railway.app`

**é¢„æœŸç»“æœ**ï¼šè·å¾—ç±»ä¼¼ `https://xxx-production.up.railway.app` çš„ URL

---

### A4. éªŒè¯åç«¯éƒ¨ç½²

#### æ­¥éª¤ 1ï¼šæµ‹è¯•å¥åº·æ£€æŸ¥
åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
https://ä½ çš„railwayåŸŸå/health
```
**é¢„æœŸç»“æœ**ï¼šé¡µé¢æ˜¾ç¤º `{"ok":true}`

#### æ­¥éª¤ 2ï¼šæµ‹è¯• APIï¼ˆä½¿ç”¨ curlï¼‰
```bash
curl -X POST https://ä½ çš„railwayåŸŸå/api/analyze \
  -H "Content-Type: application/json" \
  -d '{"text":"ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ç„¶åæˆ‘å›å®¶äº†ã€‚","mode":"drama_emotion"}'
```

**é¢„æœŸç»“æœ**ï¼šè¿”å› JSONï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
```json
{
  "score": 65,
  "risk_level": "warn",
  "summary": ["å‰5ç§’ç¼ºä¹æ˜ç¡®å†²çªæˆ–æ‚¬å¿µ", "..."],
  "issues_high": [...],
  "issues_mid": [...],
  "risky_section": "å‰æ®µ",
  "viewer_reaction": "å¦‚æœæˆ‘æ˜¯è§‚ä¼—ï¼Œæˆ‘ä¼šåœ¨å‰5ç§’è§‰å¾—æ²¡ä»€ä¹ˆæ„æ€å°±åˆ’èµ°äº†",
  "directions": ["åœ¨å¼€å¤´å»ºç«‹æ˜ç¡®çš„å†²çªæˆ–æ‚¬å¿µ", "..."],
  "evidence": [...],
  "meta": {"version": "1.0.0", "engine": "rule"}
}
```

#### æ­¥éª¤ 3ï¼šæŸ¥çœ‹ API æ–‡æ¡£
åœ¨æµè§ˆå™¨è®¿é—®ï¼š
```
https://ä½ çš„railwayåŸŸå/docs
```
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤º Swagger API æ–‡æ¡£ç•Œé¢

---

## B. å‰ç«¯ï¼ˆVercelï¼‰éƒ¨ç½²

### B1. å‡†å¤‡å‰ç«¯æ–‡ä»¶

#### æ­¥éª¤ 1ï¼šç¡®è®¤ index.html åœ¨æ ¹ç›®å½•
```bash
ls index.html
```
**é¢„æœŸç»“æœ**ï¼šæ˜¾ç¤º `index.html`

#### æ­¥éª¤ 2ï¼šåˆ›å»ºé…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œé¿å…ç¡¬ç¼–ç ï¼‰

åˆ›å»º `config.js` æ–‡ä»¶ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼š

```javascript
// config.js
window.__CONFIG__ = {
  API_BASE_URL: 'https://ä½ çš„railwayåŸŸå'  // éƒ¨ç½²åæ›¿æ¢ä¸ºå®é™… Railway åœ°å€
};
```

åˆ›å»ºåï¼Œåœ¨ `index.html` çš„ `<head>` æ ‡ç­¾å†…ï¼ˆç¬¬ 7 è¡Œåï¼‰æ·»åŠ ï¼š

```html
<script src="config.js"></script>
```

ç„¶åä¿®æ”¹ `index.html` ç¬¬ 403 è¡Œï¼Œå°†ï¼š
```javascript
const API_BASE_URL = ''; // ç•™ç©ºä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæˆ–å¡«å…¥å®Œæ•´åç«¯åœ°å€å¦‚ 'https://your-app.railway.app'
```

æ”¹ä¸ºï¼š
```javascript
// ä¼˜å…ˆä½¿ç”¨ config.js ä¸­çš„é…ç½®ï¼Œå¦åˆ™ä½¿ç”¨ç¡¬ç¼–ç æˆ–ç›¸å¯¹è·¯å¾„
const API_BASE_URL = window.__CONFIG__?.API_BASE_URL || ''; // ç•™ç©ºä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæˆ–å¡«å…¥å®Œæ•´åç«¯åœ°å€
```

**é¢„æœŸç»“æœ**ï¼š`index.html` å¯ä»¥è¯»å– `config.js` ä¸­çš„ API åœ°å€

---

### B2. Vercel éƒ¨ç½²ï¼ˆè¯¦ç»†æ­¥éª¤ï¼‰

#### æ­¥éª¤ 1ï¼šç™»å½• Vercel
1. è®¿é—® https://vercel.com
2. ç‚¹å‡»å³ä¸Šè§’ "Sign Up" æˆ– "Log In"
3. é€‰æ‹© "Continue with GitHub"
4. æˆæƒ Vercel è®¿é—®ä½ çš„ GitHub

**é¢„æœŸç»“æœ**ï¼šè¿›å…¥ Vercel Dashboard

#### æ­¥éª¤ 2ï¼šå¯¼å…¥é¡¹ç›®
1. ç‚¹å‡» "Add New..." â†’ "Project"
2. åœ¨ "Import Git Repository" ä¸­æœç´¢ä½ çš„ä»“åº“
3. æ‰¾åˆ°ä½ çš„ä»“åº“ï¼Œç‚¹å‡» "Import"

**é¢„æœŸç»“æœ**ï¼šè¿›å…¥é¡¹ç›®é…ç½®é¡µé¢

#### æ­¥éª¤ 3ï¼šé…ç½®é¡¹ç›®è®¾ç½®
åœ¨é…ç½®é¡µé¢ï¼š

1. **Project Name**ï¼šä¿æŒé»˜è®¤æˆ–ä¿®æ”¹ï¼ˆä¾‹å¦‚ï¼š`drama-checker`ï¼‰
2. **Framework Preset**ï¼šç‚¹å‡»ä¸‹æ‹‰æ¡†ï¼Œé€‰æ‹© **"Other"**
3. **Root Directory**ï¼šç•™ç©ºï¼ˆå› ä¸º `index.html` åœ¨æ ¹ç›®å½•ï¼‰
4. **Build Command**ï¼š**ç•™ç©º**ï¼ˆçº¯é™æ€æ–‡ä»¶æ— éœ€æ„å»ºï¼‰
5. **Output Directory**ï¼š**ç•™ç©º**ï¼ˆVercel ä¼šè‡ªåŠ¨è¯†åˆ«ï¼‰
6. **Install Command**ï¼š**ç•™ç©º**ï¼ˆæ— éœ€å®‰è£…ä¾èµ–ï¼‰

**é¢„æœŸç»“æœ**ï¼šæ‰€æœ‰è®¾ç½®æ­£ç¡®å¡«å†™

#### æ­¥éª¤ 4ï¼šéƒ¨ç½²
1. ç‚¹å‡» "Deploy" æŒ‰é’®
2. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆé€šå¸¸ 1-2 åˆ†é’Ÿï¼‰

**é¢„æœŸç»“æœ**ï¼š
- éƒ¨ç½²æ—¥å¿—æ˜¾ç¤º "Building..."
- ç„¶åæ˜¾ç¤º "Deploying..."
- æœ€åæ˜¾ç¤º "Ready"ï¼ˆç»¿è‰²ï¼‰
- æ˜¾ç¤ºå…¬ç½‘ URLï¼Œä¾‹å¦‚ï¼š`https://your-project.vercel.app`

#### æ­¥éª¤ 5ï¼šå¤åˆ¶å‰ç«¯ URL
å¤åˆ¶ Vercel æä¾›çš„ URLï¼Œä¾‹å¦‚ï¼š`https://your-project.vercel.app`

---

### B3. é…ç½®å‰ç«¯ API åœ°å€

#### æ–¹æ¡ˆä¸€ï¼šä¿®æ”¹ config.jsï¼ˆæ¨èï¼‰

1. ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„ `config.js`
2. å°† `API_BASE_URL` æ”¹ä¸ºä½ çš„ Railway åç«¯åœ°å€ï¼š
```javascript
window.__CONFIG__ = {
  API_BASE_URL: 'https://xxx-production.up.railway.app'  // æ›¿æ¢ä¸ºå®é™…åœ°å€
};
```
3. æäº¤å¹¶æ¨é€ï¼š
```bash
git add config.js
git commit -m "é…ç½®åç«¯ API åœ°å€"
git push origin main
```
4. Vercel ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²

**é¢„æœŸç»“æœ**ï¼šVercel æ£€æµ‹åˆ°æ–°æäº¤ï¼Œè‡ªåŠ¨è§¦å‘é‡æ–°éƒ¨ç½²

#### æ–¹æ¡ˆäºŒï¼šç›´æ¥ä¿®æ”¹ index.htmlï¼ˆç®€å•ï¼‰

1. ç¼–è¾‘ `index.html` ç¬¬ 403 è¡Œ
2. å°†ï¼š
```javascript
const API_BASE_URL = '';
```
æ”¹ä¸ºï¼š
```javascript
const API_BASE_URL = 'https://xxx-production.up.railway.app'; // æ›¿æ¢ä¸ºä½ çš„ Railway åœ°å€
```
3. æäº¤å¹¶æ¨é€ï¼š
```bash
git add index.html
git commit -m "é…ç½®åç«¯ API åœ°å€"
git push origin main
```

**é¢„æœŸç»“æœ**ï¼šVercel è‡ªåŠ¨é‡æ–°éƒ¨ç½²

---

### B4. éªŒè¯å‰ç«¯éƒ¨ç½²

#### æ­¥éª¤ 1ï¼šè®¿é—®å‰ç«¯é¡µé¢
åœ¨æµè§ˆå™¨æ‰“å¼€ Vercel URLï¼š
```
https://your-project.vercel.app
```

**é¢„æœŸç»“æœ**ï¼š
- é¡µé¢æ­£å¸¸åŠ è½½
- æ˜¾ç¤º"å‰§æƒ…çŸ­è§†é¢‘ä½“æ£€å™¨"æ ‡é¢˜
- æ˜¾ç¤ºè¾“å…¥æ¡†å’Œ"å¼€å§‹ä½“æ£€"æŒ‰é’®

#### æ­¥éª¤ 2ï¼šæµ‹è¯•å®Œæ•´æµç¨‹
1. åœ¨è¾“å…¥æ¡†è¾“å…¥æµ‹è¯•è„šæœ¬ï¼š
```
ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ä½†æ˜¯çªç„¶ä¸‹é›¨äº†ï¼Œæˆ‘å¾ˆç”Ÿæ°”ã€‚ç„¶åæˆ‘è·‘å›å®¶äº†ã€‚
```
2. ç‚¹å‡»"å¼€å§‹ä½“æ£€"æŒ‰é’®
3. ç­‰å¾…ç»“æœåŠ è½½

**é¢„æœŸç»“æœ**ï¼š
- æŒ‰é’®æ˜¾ç¤º"ä½“æ£€ä¸­â€¦"
- 1-3 ç§’åæ˜¾ç¤ºä½“æ£€ç»“æœ
- æ˜¾ç¤ºè¯„åˆ†ã€é£é™©ç­‰çº§ã€é—®é¢˜åˆ—è¡¨ç­‰

#### æ­¥éª¤ 3ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° "Console" æ ‡ç­¾
3. å†æ¬¡ç‚¹å‡»"å¼€å§‹ä½“æ£€"

**é¢„æœŸç»“æœ**ï¼š
- æ— çº¢è‰²é”™è¯¯ä¿¡æ¯
- å¯èƒ½çœ‹åˆ°è¯·æ±‚æ—¥å¿—ï¼š`POST https://xxx-production.up.railway.app/api/analyze`

---

## C. ç«¯åˆ°ç«¯éªŒè¯ä¸æ’é”™

### C1. CORS é”™è¯¯æ’æŸ¥

#### ç—‡çŠ¶
æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºï¼š
```
Access to fetch at 'https://xxx.railway.app/api/analyze' from origin 'https://xxx.vercel.app' has been blocked by CORS policy
```

#### è§£å†³æ–¹æ³•
ç¼–è¾‘ `backend/main.py` ç¬¬ 13-19 è¡Œï¼Œä¿®æ”¹ CORS é…ç½®ï¼š

```python
# é…ç½® CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://your-project.vercel.app",  # æ›¿æ¢ä¸ºä½ çš„ Vercel åŸŸå
        "http://localhost:3000",  # æœ¬åœ°å¼€å‘ç”¨
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

æˆ–è€…å…è®¸æ‰€æœ‰æ¥æºï¼ˆå¼€å‘é˜¶æ®µï¼‰ï¼š
```python
allow_origins=["*"],  # ç”Ÿäº§ç¯å¢ƒå»ºè®®æ”¹ä¸ºå…·ä½“åŸŸååˆ—è¡¨
```

**é¢„æœŸç»“æœ**ï¼šCORS é”™è¯¯æ¶ˆå¤±ï¼Œè¯·æ±‚æˆåŠŸ

---

### C2. 500 é”™è¯¯æ’æŸ¥

#### ç—‡çŠ¶
å‰ç«¯æ˜¾ç¤º"æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•"ï¼Œæˆ–è¿”å› 500 çŠ¶æ€ç 

#### æ’æŸ¥æ­¥éª¤

**æ­¥éª¤ 1ï¼šæŸ¥çœ‹ Railway æ—¥å¿—**
1. ç™»å½• Railway
2. è¿›å…¥é¡¹ç›®
3. ç‚¹å‡» "Deployments" æ ‡ç­¾
4. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²è®°å½•
5. æŸ¥çœ‹ "Logs" æ ‡ç­¾

**é¢„æœŸç»“æœ**ï¼šçœ‹åˆ°é”™è¯¯å †æ ˆä¿¡æ¯

**æ­¥éª¤ 2ï¼šå¸¸è§é”™è¯¯ä¸è§£å†³**

**é”™è¯¯ 1ï¼šModuleNotFoundError**
```
ModuleNotFoundError: No module named 'xxx'
```
**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥ `requirements.txt` æ˜¯å¦åŒ…å«è¯¥æ¨¡å—ï¼Œæ·»åŠ åé‡æ–°éƒ¨ç½²

**é”™è¯¯ 2ï¼šImportError**
```
ImportError: cannot import name 'xxx' from 'schema'
```
**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥ `schema.py` ä¸­æ˜¯å¦æœ‰è¯¥ç±»å®šä¹‰

**é”™è¯¯ 3ï¼šAttributeError**
```
AttributeError: 'NoneType' object has no attribute 'xxx'
```
**è§£å†³æ–¹æ³•**ï¼šæ£€æŸ¥ä»£ç é€»è¾‘ï¼Œæ·»åŠ ç©ºå€¼æ£€æŸ¥

---

### C3. è¶…æ—¶é—®é¢˜æ’æŸ¥

#### ç—‡çŠ¶
å‰ç«¯æ˜¾ç¤º"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•"

#### è§£å†³æ–¹æ³•

**å‰ç«¯è¶…æ—¶è®¾ç½®**ï¼ˆå·²åœ¨ä»£ç ä¸­ï¼Œé»˜è®¤ 10 ç§’ï¼‰
`index.html` ç¬¬ 445 è¡Œï¼š
```javascript
async function fetchWithTimeout(url, options, timeout = 10000) {
```
å¦‚éœ€å»¶é•¿ï¼Œä¿®æ”¹ `10000` ä¸ºæ›´å¤§å€¼ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰

**åç«¯è¶…æ—¶è®¾ç½®**ï¼ˆå¦‚æœéœ€è¦è°ƒç”¨å¤–éƒ¨ APIï¼‰
å¦‚æœé€šä¹‰åƒé—® API å“åº”æ…¢ï¼Œå¯ä»¥åœ¨è°ƒç”¨æ—¶è®¾ç½®è¶…æ—¶ï¼š

```python
import requests

response = requests.post(
    api_url,
    json=data,
    timeout=30  # 30 ç§’è¶…æ—¶
)
```

---

### C4. é€šä¹‰åƒé—®å¤±è´¥å›é€€è§„åˆ™å¼•æ“

#### æ£€æŸ¥å½“å‰å®ç°
æŸ¥çœ‹ `backend/main.py` ç¬¬ 57-63 è¡Œï¼š

```python
# æ ¹æ®é…ç½®é€‰æ‹©è¯„åˆ†å¼•æ“
if DEFAULT_ENGINE == "rule":
    result = score_by_rules(text)
else:
    # LLM æ¨¡å¼ï¼ˆé¢„ç•™ï¼Œæš‚æœªå®ç°ï¼‰
    # è¿™é‡Œå¯ä»¥è°ƒç”¨ LLM API
    result = score_by_rules(text)  # æš‚æ—¶å›é€€åˆ°è§„åˆ™å¼•æ“
```

**å½“å‰çŠ¶æ€**ï¼šå·²æœ‰å›é€€é€»è¾‘ï¼Œä½† LLM è°ƒç”¨æœªå®ç°

#### å¦‚æœéœ€è¦å®ç°é€šä¹‰åƒé—®è°ƒç”¨ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç 

åˆ›å»º `backend/llm_scorer.py`ï¼š

```python
"""
é€šä¹‰åƒé—® LLM è¯„åˆ†å¼•æ“
"""
import requests
import json
from typing import Optional
from .schema import AnalyzeResponse
from .scorer_rules import score_by_rules
from .config import LLM_API_KEY, LLM_API_URL

def score_by_llm(text: str) -> Optional[AnalyzeResponse]:
    """
    ä½¿ç”¨é€šä¹‰åƒé—® API è¿›è¡Œè¯„åˆ†
    å¤±è´¥æ—¶è¿”å› Noneï¼Œç”±è°ƒç”¨æ–¹å›é€€åˆ°è§„åˆ™å¼•æ“
    """
    if not LLM_API_KEY:
        return None
    
    try:
        # è°ƒç”¨é€šä¹‰åƒé—® API
        headers = {
            "Authorization": f"Bearer {LLM_API_KEY}",
            "Content-Type": "application/json"
        }
        
        # æ„å»ºæç¤ºè¯ï¼ˆä½¿ç”¨è¯„åˆ†ä½“ç³»è®¾è®¡æ–‡æ¡£ä¸­çš„ System Promptï¼‰
        prompt = f"""ä½ æ˜¯ä¸€ä¸ªã€å‰§æƒ…/æƒ…ç»ªç±»çŸ­è§†é¢‘è„šæœ¬è¯„åˆ†ä¸“å®¶ã€‘ã€‚è¯·å¯¹ä»¥ä¸‹è„šæœ¬è¿›è¡Œè¯„åˆ†ï¼Œè¿”å› JSON æ ¼å¼ã€‚

è„šæœ¬å†…å®¹ï¼š
{text}

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¿”å›ï¼š
{{
  "score": <0-100çš„æ•´æ•°>,
  "risk_level": "<safe|warn|bad>",
  "summary": ["é—®é¢˜1", "é—®é¢˜2", "é—®é¢˜3", "é—®é¢˜4"],
  "issues_high": [{{"text": "é—®é¢˜æè¿°", "reason": "åŸå› "}}],
  "issues_mid": [{{"text": "é—®é¢˜æè¿°", "reason": "åŸå› "}}],
  "risky_section": "<å‰æ®µ|ä¸­æ®µ|åæ®µ>",
  "viewer_reaction": "å¦‚æœæˆ‘æ˜¯è§‚ä¼—ï¼Œæˆ‘ä¼š...",
  "directions": ["æ–¹å‘1", "æ–¹å‘2", "æ–¹å‘3"],
  "evidence": [{{"text": "åŸæ–‡ç‰‡æ®µ", "position": "å‰æ®µ", "reason": "åŸå› "}}]
}}"""

        data = {
            "model": "qwen-turbo",  # æˆ– qwen-plus
            "input": {
                "messages": [
                    {
                        "role": "user",
                        "content": prompt
                    }
                ]
            },
            "parameters": {
                "temperature": 0.3,
                "max_tokens": 2000
            }
        }
        
        response = requests.post(
            LLM_API_URL or "https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation",
            headers=headers,
            json=data,
            timeout=30
        )
        
        if response.status_code != 200:
            return None
        
        result = response.json()
        
        # è§£æ LLM è¿”å›çš„ JSON
        # æ³¨æ„ï¼šéœ€è¦æ ¹æ®å®é™… API å“åº”æ ¼å¼è°ƒæ•´
        output = result.get("output", {})
        content = output.get("choices", [{}])[0].get("message", {}).get("content", "{}")
        
        # å°è¯•è§£æ JSON
        try:
            llm_result = json.loads(content)
            # è½¬æ¢ä¸º AnalyzeResponse æ ¼å¼
            return AnalyzeResponse(**llm_result)
        except:
            return None
            
    except Exception as e:
        print(f"LLM API è°ƒç”¨å¤±è´¥: {e}")
        return None
```

ç„¶åä¿®æ”¹ `backend/main.py` ç¬¬ 57-63 è¡Œï¼š

```python
# æ ¹æ®é…ç½®é€‰æ‹©è¯„åˆ†å¼•æ“
if DEFAULT_ENGINE == "rule":
    result = score_by_rules(text)
else:
    # LLM æ¨¡å¼
    from llm_scorer import score_by_llm
    result = score_by_llm(text)
    # å¦‚æœ LLM å¤±è´¥ï¼Œå›é€€åˆ°è§„åˆ™å¼•æ“
    if result is None:
        result = score_by_rules(text)
```

**é¢„æœŸç»“æœ**ï¼šLLM å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°è§„åˆ™å¼•æ“

---

### C5. å®Œæ•´éªŒè¯æ¸…å•

#### âœ… åç«¯éªŒè¯
- [ ] Railway éƒ¨ç½²æˆåŠŸï¼ŒçŠ¶æ€ä¸º "Active"
- [ ] è®¿é—® `/health` è¿”å› `{"ok":true}`
- [ ] è®¿é—® `/docs` æ˜¾ç¤º API æ–‡æ¡£
- [ ] `POST /api/analyze` è¿”å›å®Œæ•´ JSON
- [ ] Railway æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯

#### âœ… å‰ç«¯éªŒè¯
- [ ] Vercel éƒ¨ç½²æˆåŠŸï¼ŒçŠ¶æ€ä¸º "Ready"
- [ ] è®¿é—® Vercel URL é¡µé¢æ­£å¸¸åŠ è½½
- [ ] è¾“å…¥è„šæœ¬åç‚¹å‡»"å¼€å§‹ä½“æ£€"èƒ½æ­£å¸¸è¿”å›ç»“æœ
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ—  CORS é”™è¯¯
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ—  500 é”™è¯¯
- [ ] ç»“æœæ­£ç¡®æ¸²æŸ“ï¼ˆè¯„åˆ†ã€é—®é¢˜åˆ—è¡¨ç­‰ï¼‰

#### âœ… ç«¯åˆ°ç«¯éªŒè¯
- [ ] å‰ç«¯èƒ½æˆåŠŸè°ƒç”¨åç«¯ API
- [ ] è¿”å›çš„ JSON æ ¼å¼æ­£ç¡®
- [ ] é”™è¯¯æç¤ºæ­£å¸¸æ˜¾ç¤ºï¼ˆç©ºè¾“å…¥ã€è¶…æ—¶ç­‰ï¼‰
- [ ] å¤åˆ¶æŠ¥å‘ŠåŠŸèƒ½æ­£å¸¸
- [ ] å¯¼å‡º JSON åŠŸèƒ½æ­£å¸¸

---

## D. æœ€ç»ˆäº¤ä»˜ç‰©

### ä½ éœ€è¦æä¾›ç»™ç”¨æˆ·çš„é“¾æ¥

1. **å‰ç«¯è®¿é—®åœ°å€**ï¼š`https://your-project.vercel.app`
2. **åç«¯ API åœ°å€**ï¼š`https://xxx-production.up.railway.app`ï¼ˆå¯é€‰ï¼Œç”¨äº API æ–‡æ¡£ï¼‰

### æµ‹è¯•è„šæœ¬ç¤ºä¾‹

æä¾›ç»™ç”¨æˆ·æµ‹è¯•ç”¨çš„è„šæœ¬ï¼š
```
ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæˆ‘å‡ºé—¨äº†ã€‚ä½†æ˜¯çªç„¶ä¸‹é›¨äº†ï¼Œæˆ‘å¾ˆç”Ÿæ°”ã€‚ç„¶åæˆ‘è·‘å›å®¶äº†ï¼Œå¿ƒæƒ…å¾ˆæ²®ä¸§ã€‚ä¸è¿‡åæ¥å¤©æ™´äº†ï¼Œæˆ‘åˆå¼€å¿ƒèµ·æ¥ã€‚
```

---

## E. å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### Q1: Railway éƒ¨ç½²ä¸€ç›´å¤±è´¥
**A**: æ£€æŸ¥ `requirements.txt` æ˜¯å¦å®Œæ•´ï¼ŒæŸ¥çœ‹ Railway æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯

### Q2: Vercel æ˜¾ç¤º 404
**A**: ç¡®è®¤ `index.html` åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ŒRoot Directory ç•™ç©º

### Q3: å‰ç«¯æ— æ³•è¿æ¥åç«¯
**A**: 
1. æ£€æŸ¥ `API_BASE_URL` æ˜¯å¦æ­£ç¡®é…ç½®
2. æ£€æŸ¥ CORS é…ç½®æ˜¯å¦å…è®¸å‰ç«¯åŸŸå
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### Q4: é€šä¹‰åƒé—® API è°ƒç”¨å¤±è´¥
**A**: 
1. æ£€æŸ¥ `QWEN_API_KEY` æ˜¯å¦æ­£ç¡®è®¾ç½®
2. æ£€æŸ¥ `LLM_ENABLED` æ˜¯å¦ä¸º `true`
3. æŸ¥çœ‹ Railway æ—¥å¿—ç¡®è®¤é”™è¯¯
4. ç³»ç»Ÿä¼šè‡ªåŠ¨å›é€€åˆ°è§„åˆ™å¼•æ“

---

## ğŸ“ éƒ¨ç½²åæ£€æŸ¥æ¸…å•

- [ ] åç«¯å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] åç«¯ API æµ‹è¯•é€šè¿‡
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸åŠ è½½
- [ ] å‰ç«¯èƒ½æˆåŠŸè°ƒç”¨åç«¯
- [ ] ä½“æ£€åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] é”™è¯¯å¤„ç†æ­£å¸¸
- [ ] æ—  CORS é”™è¯¯
- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] API Key æœªæš´éœ²åœ¨å‰ç«¯ä»£ç ä¸­

**å®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤åï¼Œä½ çš„åº”ç”¨å°±å¯ä»¥å¯¹å¤–åˆ†äº«äº†ï¼** ğŸ‰

